/**
* Tencent is pleased to support the open source community by making 蓝鲸智云PaaS平台社区版 (BlueKing PaaS Community Edition) available.
* Copyright (C) 2017-2018 THL A29 Limited, a Tencent company. All rights reserved.
* Licensed under the MIT License (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at
* http://opensource.org/licenses/MIT
* Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
*/
jQuery.fn.pagination=function(opt){function get_table_data(page_index,contain_obj){is_select&&($("#select_pagination").attr("class")||$('<label>每页显示行</label><select id="select_pagination" name="items_per_page" class="span1"><option> </option><option>5</option><option>10</option><option>15</option><option>20</option><option>25</option><option>30</option></select>').insertBefore(panel));var items_per_page=parseInt($("#select_pagination").val())?parseInt($("#select_pagination").val()):opts.items_per_page?opts.items_per_page:10,max_elem=Math.min((page_index+1)*items_per_page,total_num)-1;if(!$("#loading_example")[0]&&"TBODY"==$(opts.table_obj).get(0).tagName){$(opts.table_obj).parent("table").addClass("loading_position");var cols=0;$(opts.table_obj).parent("table").find("thead tr:first th").each(function(){cols+=$(this).attr("colspan")?parseInt($(this).attr("colspan")):1}),$('<td style="padding:0" colspan="'+cols+'"><div class="loading_example opacity_7" style="top:'+$(opts.table_obj).parent("table").find("thead").height()+"px; height:"+$(opts.table_obj).height()+'px"><img class="loading_image" src="'+loading_img+'" title="正在努力加载数据。。。" alt="正在努力加载数据。。。"/></div></td>').appendTo($(opts.table_obj))}if(opts.async)$(".loading_example").show(),$.get(opts.url+(opts.url.indexOf("?")<0?"?page=":"page=")+page_index,function(data){var get_data=eval("("+data+")");$(opts.table_obj).html(get_data.data),total_num=get_data.total_num,extends_par=get_data.extends_par,opts.callback.call(this,extends_par),$(".loading_example").hide()});else{for(var from=(page_index-1)*items_per_page+1,to=from+items_per_page-1,rows=$(opts.table_obj).find("tr"),i=1;i<rows.length;i++)rows[i].style.display=i<from||i>to?"none":"";total_num=rows.length-1,extends_par=""}return!1}var opts=jQuery.extend({url:"",items_per_page:10,current_page:1,link_to:"###",num_display_items:4,table_obj:"",callback:function(){},is_select:!1,async:!0},opt||{}),total_num,extends_par,panel=$(this),loading_img="",is_select=opts.is_select;return this.each(function(){function t(t){return Math.ceil(t/opts.items_per_page)}function a(a){var e=Math.ceil(opts.num_display_items/2),s=t(a),n=s-opts.num_display_items;return[opts.current_page>e?Math.max(Math.min(opts.current_page-e,n),1):1,opts.current_page>e?Math.min(opts.current_page+e,s):Math.min(opts.num_display_items,s)]}function e(t,a,e){opts.current_page=t,s(e);var n=get_table_data(t,panel);return n||(a.stopPropagation?a.stopPropagation():a.cancelBubble=!0),n}function s(s){$("#pagination_id").show(),$("#page_goto").show(),panel.empty();var n=a(s),o=t(s),p=function(t){return function(a){return e(t,a,s)}},i=function(t,a){if(t=t<1?1:t<o?t:o,a=jQuery.extend({text:t,classes:""},a||{}),t==opts.current_page)var e=$("<span class='active btn'>"+a.text+"</span>");else if("disabled"!=a.classes)var e=$("<a class='btn'>"+a.text+"</a>").bind("click",p(t)).attr("href",opts.link_to.replace(/__id__/,t));else var e=$("<a class='btn'>"+a.text+"</a>");a.classes&&e.addClass(a.classes),panel.append(e)};if(opts.current_page>1?i(opts.current_page-1,{text:"上一页",classes:"prev"}):i(opts.current_page+1,{text:"上一页",classes:"disabled"}),n[1]-n[0]>4&&(n[1]=n[0]+4),n[0]>0){for(var l=Math.min(2,n[0]),r=1;r<l;r++)i(r);n[0]>2&&$("<span class='btn cursor_default'>...</span>").appendTo(panel)}for(var r=n[0];r<n[1];r++)i(r);if(n[1]<o+1){o-2>n[1]&&$("<span class='btn cursor_default'>...</span>").appendTo(panel);for(var _=Math.max(o-2,n[1]),r=_;r<o+1;r++)i(r)}opts.current_page<o?i(opts.current_page+1,{text:"下一页",classes:"next"}):i(opts.current_page+1,{text:"下一页",classes:"disabled"}),0==s&&($("#pagination_id").hide(),$("#page_goto").hide())}if(!$("#loading_example")[0]&&"TBODY"==$(opts.table_obj).get(0).tagName){var n=0;$(opts.table_obj).parent("table").find("thead tr:first th").each(function(){n+=$(this).attr("colspan")?parseInt($(this).attr("colspan")):1}),$('<tr><td style="height:275px; padding:0" colspan="'+n+'"><div class="loading_position"><div class="loading_example opacity_7 hide"><img class="loading_image" src="'+loading_img+'" title="正在努力加载数据。。。" alt="正在努力加载数据。。。"/></div></div></td></tr>').appendTo($(opts.table_obj))}if(opts.async)$(".loading_example").show(),$.getJSON(opts.url+(opts.url.indexOf("?")<0?"?page=":"page=")+opts.current_page,function(t){var a=t;$(opts.table_obj).html(a.data),total_num=a.total_num,extends_par=a.extends_par,total_num>=0&&s(total_num),opts.callback.call(this,extends_par),$(".loading_example").hide()});else{for(var o=(opts.current_page-1)*opts.items_per_page+1,p=o+opts.items_per_page-1,i=$(opts.table_obj).find("tr"),l=1;l<i.length;l++)i[l].style.display=l<o||l>p?"none":"";total_num=i.length-1,extends_par="",total_num>=0&&s(total_num)}})};
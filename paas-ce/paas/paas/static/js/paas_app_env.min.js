/**
* Tencent is pleased to support the open source community by making 蓝鲸智云PaaS平台社区版 (BlueKing PaaS Community Edition) available.
* Copyright (C) 2017-2018 THL A29 Limited, a Tencent company. All rights reserved.
* Licensed under the MIT License (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at
* http://opensource.org/licenses/MIT
* Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
*/
$(function(){$("#user_env_table").on("click",".env_edit_btn",function(){var t=$(this).closest(".env_record");t.addClass("env_edit_status"),t.find("input").removeAttr("disabled"),t.find("select").removeAttr("disabled");var e=t.find(".env_name").val(),n=t.find(".env_val").val(),a=t.find(".env_mode").val(),i=t.find(".env_intro").val();return t.attr("data-old-name",e),t.attr("data-old-val",n),t.attr("data-old-intro",i),t.attr("data-old-mode",a),!1}),$("#user_env_table").on("click",".env_cancel_btn",function(){var t=$(this).closest(".env_record");t.removeClass("env_edit_status"),t.find("input").attr("disabled","disabled"),t.find("select").attr("disabled","disabled");var e=t.attr("data-old-name"),n=t.attr("data-old-val"),a=t.attr("data-old-intro"),i=t.attr("data-old-mode");if(e||n||a||i){t.find(".env_name").val(e),t.find(".env_val").val(n),t.find(".env_intro").val(a),t.find(".env_mode").val(i)}else t.remove();return!1}),$("#user_env_table").on("click",".env_save_btn",function(){var t=($(this),$(this).closest(".env_record")),e=t.find(".env_intro").val(),n=t.find(".env_name").val(),a=t.find(".env_val").val(),i=t.find(".env_mode").val(),d=t.find(".env_id").val();if(!n)return art.dialog({id:"bktips",width:300,icon:"warning",lock:!0,content:"请输入变量名"}).time(1),t.find(".env_name").focus(),!1;if(!a)return art.dialog({id:"bktips",width:300,icon:"warning",lock:!0,content:"请输入变量值"}).time(1),t.find(".env_val").focus(),!1;if(!e)return art.dialog({id:"bktips",width:300,icon:"warning",lock:!0,content:"请输入说明"}).time(1),t.find(".env_intro").focus(),!1;var l={name:n,value:a,intro:e,mode:i},o=$("#app_code").val(),r=site_url+"app/"+o+"/env/";type="POST",d&&(l.id=d,type="PUT",r=r+d+"/");$.ajax({url:r,type:type,data:l,success:function(e){e.result?(art.dialog({id:"bktips",width:300,icon:"succeed",lock:!0,content:"保存成功"}).time(1),t.find("input").attr("disabled","disabled"),t.find("select").attr("disabled","disabled"),t.removeClass("env_edit_status"),t.find(".env_id").val(e.id)):art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:e.message}).time(1)},fail:function(t,e,n){art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:"保存失败!"}).time(1)}});return!1}),$(".env_add_btn").on("click",function(){var t=$("#mode_choices_html").html(),e=['<tr class="env_record env_edit_status">','<input  type="hidden" class="env_id" disabled value="" />',"    <td>",'       <div class="env_key_box">','           <input class="form-control env_name" value="" placeholder="请输入变量名"/>','           <span class="env_prefix">BKAPP_</span>',"        </div>","    </td>","    <td>",'        <input class="form-control env_val" value="" placeholder="请输入变量值">',"    </td>","    <td>",t,"    </td>","    <td>",'       <input class="form-control env_intro" value="" placeholder="请输入说明">',"    </td>","    <td>",'    <button type="button" class="btn-info btn-xs env_save_btn">保存</button>','       <button type="button" class="btn-xs env_cancel_btn">取消</button> ','  <a href="#" title="编辑" class="dev_env_opera env_edit_btn"><span aria-hidden="true" class="glyphicon glyphicon-edit"></span></a>','  <a href="#" title="删除" class="dev_env_opera env_del_btn"><span aria-hidden="true" class="glyphicon glyphicon-remove-circle"></span></a>',"    </td>","</tr>"].join("");return $("#no_record_row").hide(),$("#user_env_table").append($(e)),!1}),$("#user_env_table").on("click",".env_del_btn",function(){var t=$(this).closest(".env_record"),e=t.find(".env_id").val();if(e){var n=$("#app_code").val(),a=site_url+"app/"+n+"/env/"+e+"/";art.dialog({title:"删除确认",width:340,icon:"question",lock:!0,content:"<div class='t_s14'>您确定删除该环境变量吗?</div>",ok:function(){art.dialog({id:"bktips",width:300,icon:"warning",lock:!0,content:"正在进行删除操作，请稍后..."}),$.ajax({url:a,type:"DELETE",success:function(e){art.dialog({id:"bktips"}).close(),e.result?(art.dialog({id:"bktips",width:300,icon:"succeed",lock:!0,content:e.message}).time(1),t.remove()):art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:e.message}).time(1)}})},cancel:function(){},okVal:"确定",cancelVal:"取消"})}})});